const showFullscreen=(e,t=document.getElementById("fullscreen-container"),n=document.getElementById("fullscreen-image"))=>{n.src=e,t.style.display="flex",document.body.style.overflow="hidden"};const closeFullscreen=(e=document.getElementById("fullscreen-container"))=>{e.style.display="none",document.body.style.overflow="auto"};const showNotification=(e,t="success",n=3e3,o=document.getElementById("notification"))=>{o.textContent=e,o.style.transform="translateY(0)",o.style.backgroundColor={success:"#10B981",error:"#EF4444",warning:"#F59E0B",info:"#3B82F6"}[t],o.style.display="block",setTimeout(()=>{o.style.opacity="1"},10),n>0&&setTimeout(()=>{o.style.opacity="0",o.style.transform="translateY(-10px)",setTimeout(()=>{o.style.display="none"},300)},n);return o};const handleRateLimitError=(e,t)=>{if(e&&e.status===429){showNotification("تعداد درخواست‌ها بیش از حد است. چند لحظه صبر کنید.","warning",6e3);const n=document.querySelectorAll(".approve-btn, .reject-btn, .reset-btn, .bulk-approve");return n.forEach(e=>{e.disabled=!0,e.classList.add("opacity-50","cursor-not-allowed")}),setTimeout(()=>{n.forEach(e=>{e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed")}),showNotification("اکنون می‌توانید ادامه دهید.","info")},3e4),!0}return!1};const processImageAction=(e,t,n,o="تصویر با موفقیت پردازش شد")=>{const a=showNotification("در حال ارسال...", "info",0);fetch(t,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json","Accept":"application/json"}}).then(e=>{if(429===e.status)return e.json().then(e=>{throw{status:429,message:e.message}});if(!e.ok)throw new Error(`خطای HTTP: ${e.status}`);return e.json()}).then(t=>{if(a&&a.remove(),t.success){const a=document.querySelector(`[data-image-id="${e}"]`);a.style.transition="opacity .5s ease, transform .5s ease",a.style.opacity="0",a.style.transform="scale(0.8)",setTimeout(()=>{a.remove(),showNotification(o,"success");const e=document.querySelectorAll("#image-gallery [data-image-id]").length,t=document.getElementById("image-gallery");0===e&&(t.innerHTML=`<div class="w-full text-center py-8 bg-yellow-100 text-yellow-700"><p class="font-bold text-lg">${n}</p></div>`);const a=document.querySelector(".bulk-approve");a&&(a.style.display="none")},500)}}).catch(t=>{a&&a.remove(),console.error(t),handleRateLimitError(t,"action")||showNotification(`خطا: ${t.message||"خطای نامشخص"}`,"error")})};document.addEventListener("keydown",e=>{"Escape"===e.key&&document.getElementById("fullscreen-container").style.display==="flex"&&closeFullscreen()});
